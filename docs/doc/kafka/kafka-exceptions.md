# –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ Kafka

–û—Ç–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å üëç. –†–∞–±–æ—Ç–∞ —Å **Apache Kafka** —á–∞—Å—Ç–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è —Ç–∏–ø–æ–≤—ã–º–∏
–æ—à–∏–±–∫–∞–º–∏, –æ—Å–æ–±–µ–Ω–Ω–æ –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—à—å –≤–Ω–µ–¥—Ä—è—Ç—å –µ—ë –≤ –ø—Ä–æ–¥–∞–∫—à–Ω. –Ø —Å–≥—Ä—É–ø–ø–∏—Ä–æ–≤–∞–ª
–∏—Ö –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º:

---

## üîπ –û—à–∏–±–∫–∏ –ø—Ä–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ –±—Ä–æ–∫–µ—Ä–æ–≤

1. **–ù–µ–≤–µ—Ä–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è `listeners` –∏ `advertised.listeners`**
   ‚Äì –∫–ª–∏–µ–Ω—Ç—ã –Ω–µ –º–æ–≥—É—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è, –æ—Å–æ–±–µ–Ω–Ω–æ –∏–∑ Docker/Kubernetes.
   ‚Äì —á–∞—Å—Ç–∞—è –æ—à–∏–±–∫–∞: –≤—ã—Å—Ç–∞–≤–∏—Ç—å `localhost:9092` –≤–º–µ—Å—Ç–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ hostname –∏–ª–∏ IP.

2. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `replication.factor` –∏ `min.insync.replicas`**
   ‚Äì –º–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Å—Ç–∏ –∫ –ø–æ—Ç–µ—Ä–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —Å–±–æ–µ –±—Ä–æ–∫–µ—Ä–∞.
   ‚Äì –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤—ã—Å—Ç–∞–≤–ª–µ–Ω `replication.factor=1` –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.

3. **–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Ä–µ—Å—É—Ä—Å–æ–≤ (disk, RAM, network)**
   ‚Äì Kafka –æ—á–µ–Ω—å —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω–∞ –∫ –¥–∏—Å–∫—É –∏ —Å–µ—Ç–µ–≤–æ–π –ø—Ä–æ–ø—É—Å–∫–Ω–æ–π —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏.
   ‚Äì —Ç–∏–ø–∏—á–Ω–æ: –º–∞–ª–µ–Ω—å–∫–∏–π –¥–∏—Å–∫ ‚Üí —Å–µ–≥–º–µ–Ω—Ç—ã –±—ã—Å—Ç—Ä–æ –∑–∞–ø–æ–ª–Ω—è—é—Ç—Å—è ‚Üí `LogDirFailure`.

4. **–ü–ª–æ—Ö–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è GC (Java)**
   ‚Äì –ø–∞—É–∑—ã GC –≤—ã–∑—ã–≤–∞—é—Ç –ª–∞–≥–∏, –∑–∞–¥–µ—Ä–∂–∫–∏ –≤ –ø—Ä–æ–¥–∞–∫—à–Ω–µ.

---

## üîπ –û—à–∏–±–∫–∏ –ø—Ä–∏ —Ä–∞–±–æ—Ç–µ —Å —Ç–æ–ø–∏–∫–∞–º–∏ –∏ –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏

5. **–ú–∞–ª–æ –ø–∞—Ä—Ç–∏—Ü–∏–π**
   ‚Äì –æ–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ—Ç –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å (—Ç–æ–ª—å–∫–æ —Å—Ç–æ–ª—å–∫–æ –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–µ–π –≤ –≥—Ä—É–ø–ø–µ,
   —Å–∫–æ–ª—å–∫–æ –ø–∞—Ä—Ç–∏—Ü–∏–π).

6. **–°–ª–∏—à–∫–æ–º –º–Ω–æ–≥–æ –ø–∞—Ä—Ç–∏—Ü–∏–π**
   ‚Äì –Ω–∞–≥—Ä—É–∑–∫–∞ –Ω–∞ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –∏ metadata cache, –¥–æ–ª–≥–∏–π —Ä–µ–±–∞–ª–∞–Ω—Å.

7. **–£–¥–∞–ª–µ–Ω–∏–µ –∏–ª–∏ –ø–µ—Ä–µ–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞**
   ‚Äì –ø–æ—Ç—Ä–µ–±–∏—Ç–µ–ª–∏ —Ç–µ—Ä—è—é—Ç –æ—Ñ—Ñ—Å–µ—Ç—ã, –Ω–∞—á–∏–Ω–∞—é—Ç—Å—è –æ—à–∏–±–∫–∏
   `UnknownTopicOrPartitionException`.

---

## üîπ –û—à–∏–±–∫–∏ –ø—Ä–æ–¥—é—Å–µ—Ä–æ–≤

8. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–π (`acks=0` –∏–ª–∏ `acks=1`)**
   ‚Äì –¥–∞–Ω–Ω—ã–µ –º–æ–≥—É—Ç —Ç–µ—Ä—è—Ç—å—Å—è –ø—Ä–∏ —Å–±–æ–µ –±—Ä–æ–∫–µ—Ä–∞.
   ‚Äì –ø—Ä–∞–≤–∏–ª—å–Ω–µ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `acks=all`.

9. **–ë–æ–ª—å—à–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è (>1 MB –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)**
   ‚Äì –≤—ã–±–∏–≤–∞–µ—Ç `RecordTooLargeException`.
   ‚Äì –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å `max.request.size` (producer) –∏ `message.max.bytes` (broker).

10. **–ù–µ–æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ä–µ—Ç—Ä–∞–∏**
    ‚Äì –¥—É–±–ª–∏–∫–∞—Ç—ã —Å–æ–æ–±—â–µ–Ω–∏–π, –µ—Å–ª–∏ producer –Ω–µ–∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω—ã–π.
    ‚Äì —Ä–µ—à–µ–Ω–∏–µ: –≤–∫–ª—é—á–∏—Ç—å `enable.idempotence=true`.

---

## üîπ –û—à–∏–±–∫–∏ –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤

11. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∞–≤—Ç–æ-–∫–æ–º–º–∏—Ç –æ—Ñ—Ñ—Å–µ—Ç–æ–≤**
    ‚Äì –ø—Ä–∏ `enable.auto.commit=true` –º–æ–∂–Ω–æ –ø–æ—Ç–µ—Ä—è—Ç—å –∏–ª–∏ –¥—É–±–ª–∏—Ä–æ–≤–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
    ‚Äì —á–∞—Å—Ç–æ –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **manual commit**.

12. **–†–µ–±–∞–ª–∞–Ω—Å –ø—Ä–∏ –¥–æ–ª–≥–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ**
    ‚Äì `max.poll.interval.ms` —Å–ª–∏—à–∫–æ–º –º–∞–ª–µ–Ω—å–∫–∏–π ‚Üí consumer –≤—ã–ª–µ—Ç–∞–µ—Ç –∏–∑ –≥—Ä—É–ø–ø—ã.

13. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π `auto.offset.reset`**
    ‚Äì default=`latest`: –Ω–æ–≤—ã–π consumer –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç —Å—Ç–∞—Ä—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
    ‚Äì —á–∞—Å—Ç–æ –Ω—É–∂–Ω–æ `earliest` –≤ —Ç–µ—Å—Ç–∞—Ö –∏ –ø–æ—Ç–æ–∫–æ–≤–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–µ.

---

## üîπ –û—à–∏–±–∫–∏ —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏–∏

14. **–ù–µ—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥–∞**
    ‚Äì Kafka —Ä–∞–±–æ—Ç–∞–µ—Ç "—Ç–∏—Ö–æ" –¥–æ –º–æ–º–µ–Ω—Ç–∞ —Å–±–æ—è.
    ‚Äì –Ω—É–∂–Ω–æ —Å–ª–µ–¥–∏—Ç—å –∑–∞ lag, ISR, GC, disk usage.

15. **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ–ª–∏—Ç–∏–∫–∏ —Ä–µ—Ç–µ–Ω—Ü–∏–∏ (`retention.ms`)**
    ‚Äì –ª–æ–≥–∏ —Ä–∞—Å—Ç—É—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ, –ø–æ–∫–∞ –Ω–µ —É–ø–∞–¥–µ—Ç –¥–∏—Å–∫.

16. **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ security**
    ‚Äì –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω TLS/SASL, –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –≥–æ–Ω—è—é—Ç—Å—è –≤ plaintext.

---

‚úÖ **–ò—Ç–æ–≥–æ**:
–ì–ª–∞–≤–Ω—ã–µ "–ø–æ–¥–≤–æ–¥–Ω—ã–µ –∫–∞–º–Ω–∏" ‚Äî **—Å–µ—Ç–µ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –Ω–µ–≤–µ—Ä–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
–ø–∞—Ä—Ç–∏—Ü–∏–π/—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏, –æ—Ñ—Ñ—Å–µ—Ç—ã —É –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤ –∏ –∏–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞**.

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç Kafka –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–ù–∞—Å—Ç—Ä–æ–π —Å–µ—Ç–µ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∞–≤–∏–ª—å–Ω–æ**

    * `listeners` = –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –∞–¥—Ä–µ—Å –±—Ä–æ–∫–µ—Ä–∞
    * `advertised.listeners` = –∞–¥—Ä–µ—Å, –¥–æ—Å—Ç—É–ø–Ω—ã–π –∫–ª–∏–µ–Ω—Ç–∞–º
    * –ü—Ä–æ–≤–µ—Ä—è–π —Ä–∞–±–æ—Ç—É –≤–Ω—É—Ç—Ä–∏ Docker/K8s.

2. **–ò—Å–ø–æ–ª—å–∑—É–π —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é ‚â• 3**

    * `replication.factor=3`
    * `min.insync.replicas=2`
    * –¢–∞–∫ –¥–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—Ç—Å—è –ø—Ä–∏ –ø–∞–¥–µ–Ω–∏–∏ –±—Ä–æ–∫–µ—Ä–∞.

3. **–í—Å–µ–≥–¥–∞ –≤–∫–ª—é—á–∞–π –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è (`acks=all`)**

    * –≠—Ç–æ –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–∞–µ—Ç –ø–æ—Ç–µ—Ä—é —Å–æ–æ–±—â–µ–Ω–∏–π –ø—Ä–∏ —Å–±–æ–µ.

4. **–í–∫–ª—é—á–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å –ø—Ä–æ–¥—é—Å–µ—Ä–∞**

    * `enable.idempotence=true`
    * –£–±–∏—Ä–∞–µ—Ç –¥—É–±–ª–∏–∫–∞—Ç—ã –ø—Ä–∏ —Ä–µ—Ç—Ä–∞—è—Ö.

5. **–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π –æ—Ñ—Ñ—Å–µ—Ç—ã –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤**

    * –ù–µ –ø–æ–ª–∞–≥–∞–π—Å—è —Ç–æ–ª—å–∫–æ –Ω–∞ `enable.auto.commit`.
    * –î–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏—Å–ø–æ–ª—å–∑—É–π —Ä—É—á–Ω–æ–π commit –ø–æ—Å–ª–µ –æ–±—Ä–∞–±–æ—Ç–∫–∏.

6. **–°–ª–µ–¥–∏ –∑–∞ –≤—Ä–µ–º–µ–Ω–µ–º –æ–±—Ä–∞–±–æ—Ç–∫–∏ —É –∫–æ–Ω—Å—É–º–µ—Ä–æ–≤**

    * –£–≤–µ–ª–∏—á–∏–≤–∞–π `max.poll.interval.ms`, –µ—Å–ª–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –¥–æ–ª–≥–∞—è.
    * –ò–Ω–∞—á–µ consumer –±—É–¥–µ—Ç –≤—ã–∫–∏–Ω—É—Ç –∏–∑ –≥—Ä—É–ø–ø—ã –ø—Ä–∏ —Ä–µ–±–∞–ª–∞–Ω—Å–µ.

7. **–ù–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–π –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π**

    * –ü–∞—Ä—Ç–∏—Ü–∏–π –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª–∏–∑–º–∞, –Ω–æ –Ω–µ —Ç—ã—Å—è—á–∏ –±–µ–∑
      –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.
    * –ù–∞—á–∏–Ω–∞–π —Å `(#CPU * 2)` –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–π –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º.

8. **–û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–π —Ä–∞–∑–º–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π**

    * –ù–∞—Å—Ç—Ä–æ–π `max.request.size`, `message.max.bytes`.
    * –õ—É—á—à–µ –¥—Ä–æ–±–∏—Ç—å payload –Ω–∞ –±–∞—Ç—á–∏.

9. **–í–∫–ª—é—á–∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç–∏–Ω–≥**

    * –û—Ç—Å–ª–µ–∂–∏–≤–∞–π **consumer lag**, **ISR**, **disk usage**, **latency**.
    * –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Prometheus + Grafana = must have.

10. **–ù–∞—Å—Ç—Ä–æ–π –ø–æ–ª–∏—Ç–∏–∫—É —Ö—Ä–∞–Ω–µ–Ω–∏—è (`retention.ms`)**

* –õ–æ–≥–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Ä–∞—Å—Ç–∏ –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ.
* –í—ã–±–∏—Ä–∞–π –ø–æ SLA:

    * realtime ‚Üí —á–∞—Å—ã
    * –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ ‚Üí –¥–Ω–∏/–Ω–µ–¥–µ–ª–∏.

---

‚ö° –ë–æ–Ω—É—Å-–ø—Ä–∞–≤–∏–ª–æ: **–í–∫–ª—é—á–∏ TLS/SASL** (–∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è + —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏–µ). –ë–µ–∑ —ç—Ç–æ–≥–æ
–≤—Å—ë –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ.

---

## –ù–∞–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤ (
`server.properties` + producer + consumer), –∫–æ—Ç–æ—Ä—ã–π —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —ç—Ç–æ–º—É —á–µ–∫-–ª–∏—Å—Ç—É

üî• –û—Ç–ª–∏—á–Ω–æ, —Ç–æ–≥–¥–∞ –≤–æ—Ç —Ç–µ–±–µ –≥–æ—Ç–æ–≤—ã–π –Ω–∞–±–æ—Ä –∫–æ–Ω—Ñ–∏–≥–æ–≤, —Å–æ–±—Ä–∞–Ω–Ω—ã–π –ø–æ–¥ —á–µ–∫-–ª–∏—Å—Ç.

---

## üìå `server.properties` (–±—Ä–æ–∫–µ—Ä Kafka)

```properties
############################
# –°–µ—Ç—å
############################
listeners=PLAINTEXT://0.0.0.0:9092
advertised.listeners=PLAINTEXT://my-kafka-broker:9092
broker.id=1
############################
# –•—Ä–∞–Ω–µ–Ω–∏–µ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è
############################
log.dirs=/var/lib/kafka/data
num.partitions=3
default.replication.factor=3
min.insync.replicas=2
unclean.leader.election.enable=false
############################
# –õ–∏–º–∏—Ç—ã
############################
message.max.bytes=10485760        # 10MB
replica.fetch.max.bytes=10485760
############################
# –†–µ—Ç–µ–Ω—Ü–∏—è
############################
log.retention.ms=604800000        # 7 –¥–Ω–µ–π
log.segment.bytes=1073741824      # 1GB
log.retention.check.interval.ms=300000
############################
# –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
############################
metrics.recording.level=INFO
```

---

### üìå –ö–æ–Ω—Ñ–∏–≥ **Producer** (Kotlin/Spring Boot)

```kotlin
@Bean
fun producerFactory(): ProducerFactory<String, String> {
    val config = mapOf(
        ProducerConfig.BOOTSTRAP_SERVERS_CONFIG to "my-kafka-broker:9092",
        ProducerConfig.KEY_SERIALIZER_CLASS_CONFIG to StringSerializer::class.java,
        ProducerConfig.VALUE_SERIALIZER_CLASS_CONFIG to StringSerializer::class.java,
        ProducerConfig.ACKS_CONFIG to "all",
        ProducerConfig.ENABLE_IDEMPOTENCE_CONFIG to true,
        ProducerConfig.RETRIES_CONFIG to Int.MAX_VALUE,
        ProducerConfig.MAX_IN_FLIGHT_REQUESTS_PER_CONNECTION to 5,
        ProducerConfig.LINGER_MS_CONFIG to 20,
        ProducerConfig.BATCH_SIZE_CONFIG to 32768,
        ProducerConfig.MAX_REQUEST_SIZE_CONFIG to 10485760 // 10MB
    )
    return DefaultKafkaProducerFactory(config)
}
```

---

### üìå –ö–æ–Ω—Ñ–∏–≥ **Consumer** (Kotlin/Spring Boot)

```kotlin
@Bean
fun consumerFactory(): ConsumerFactory<String, String> {
    val config = mapOf(
        ConsumerConfig.BOOTSTRAP_SERVERS_CONFIG to "my-kafka-broker:9092",
        ConsumerConfig.KEY_DESERIALIZER_CLASS_CONFIG to StringDeserializer::class.java,
        ConsumerConfig.VALUE_DESERIALIZER_CLASS_CONFIG to StringDeserializer::class.java,
        ConsumerConfig.GROUP_ID_CONFIG to "my-consumer-group",
        ConsumerConfig.ENABLE_AUTO_COMMIT_CONFIG to false, // —Ä—É—á–Ω–æ–π commit
        ConsumerConfig.AUTO_OFFSET_RESET_CONFIG to "earliest",
        ConsumerConfig.MAX_POLL_RECORDS_CONFIG to 500,
        ConsumerConfig.MAX_POLL_INTERVAL_MS_CONFIG to 300000 // 5 –º–∏–Ω—É—Ç
    )
    return DefaultKafkaConsumerFactory(config)
}
```

–ü—Ä–∏–º–µ—Ä —Ä—É—á–Ω–æ–≥–æ –∫–æ–º–º–∏—Ç–∞ –æ—Ñ—Ñ—Å–µ—Ç–∞:

```kotlin
@KafkaListener(topics = ["my-topic"], groupId = "my-consumer-group")
fun listen(records: List<ConsumerRecord<String, String>>, ack: Acknowledgment) {
    records.forEach { record ->
        println("Received: ${record.value()}")
        // –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
    }
    ack.acknowledge() // —Ä—É—á–Ω–æ–π –∫–æ–º–º–∏—Ç –ø–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
}
```

---

### üìå –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ (Prometheus JMX Exporter)

–î–æ–±–∞–≤—å JMX Exporter –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä:

```yaml
KAFKA_OPTS: "-javaagent:/usr/app/jmx_prometheus_javaagent-0.16.1.jar=7071:/etc/jmx-exporter/kafka.yml"
```

‚úÖ –≠—Ç–æ—Ç –Ω–∞–±–æ—Ä –¥–∞—Å—Ç —Ç–µ–±–µ:

* –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –¥–æ—Å—Ç–∞–≤–∫—É (`acks=all`, `enable.idempotence=true`),
* –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –ø–æ—Ç–µ—Ä–∏ –æ—Ñ—Ñ—Å–µ—Ç–æ–≤ (—Ä—É—á–Ω–æ–π commit),
* —É–ø—Ä–∞–≤–ª—è–µ–º—É—é —Ä–µ—Ç–µ–Ω—Ü–∏—é,
* –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
