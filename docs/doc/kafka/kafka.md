# Kafka. –û—Å–Ω–æ–≤—ã —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏.

–ë—Ä–æ–∫–µ—Ä - —Å–µ—Ä–≤–µ—Ä.

–¢–æ–ø–∏–∫ - —Ç–µ–º–∞ —Å–æ–æ–±—â–µ–Ω–∏–π.

–¢–æ–ø–∏–∫ —Å–æ—Å—Ç–æ–∏—Ç –∏–∑ –ø–∞—Ä—Ç–∏—Ü–∏–π.

–ü–∞—Ä—Ç–∏—Ü–∏–∏.<br>
–ü–∞—Ä—Ç–∏—Ü–∏–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω—ã –º–µ–∂–¥—É –±—Ä–æ–∫–µ—Ä–∞–º–∏ –≤–Ω—É—Ç—Ä–∏ –æ–¥–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞.<br>
–ü–æ–¥–æ–±–Ω–∞—è —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ—Å—Ç—å –≤–∞–∂–Ω–∞ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞,
—Ç–∞–∫ –∫–∞–∫ –æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∫–ª–∏–µ–Ω—Ç–∞–º –ø–∏—Å–∞—Ç—å –∏ —á–∏—Ç–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö
–±—Ä–æ–∫–µ—Ä–æ–≤ –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ.<br>
–ö–æ–≥–¥–∞ –Ω–æ–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ —Ç–æ–ø–∏–∫, –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ –æ–Ω–æ –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –≤
–æ–¥–Ω—É –∏–∑ –ø–∞—Ä—Ç–∏—Ü–∏–π —ç—Ç–æ–≥–æ —Ç–æ–ø–∏–∫–∞. –°–æ–æ–±—â–µ–Ω–∏—è —Å –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏ –∫–ª—é—á–∞–º–∏ –≤—Å–µ–≥–¥–∞
–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ –æ–¥–Ω—É –∏ —Ç—É –∂–µ –ø–∞—Ä—Ç–∏—Ü–∏—é, —Ç–µ–º —Å–∞–º—ã–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É—è –æ—á–µ—Ä–µ–¥–Ω–æ—Å—Ç—å –∏–ª–∏
–ø–æ—Ä—è–¥–æ–∫ –∑–∞–ø–∏—Å–∏ –∏ —á—Ç–µ–Ω–∏—è.

–†–µ–ø–ª–∏–∫–∞.<br>
–î–ª—è –≥–∞—Ä–∞–Ω—Ç–∏–∏ —Å–æ—Ö—Ä–∞–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –≤ Kafka –º–æ–∂–µ—Ç –±—ã—Ç—å —Ä–µ–ø–ª–∏—Ü–∏—Ä–æ–≤–∞–Ω–∞
n —Ä–∞–∑, –≥–¥–µ n ‚Äî replication factor. –¢–∞–∫–∏–º –æ–±—Ä–∞–∑–æ–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ
–Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∫–æ–ø–∏–π —Å–æ–æ–±—â–µ–Ω–∏—è, —Ö—Ä–∞–Ω—è—â–∏—Ö—Å—è –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–∞—Ö.

–£ –∫–∞–∂–¥–æ–π –ø–∞—Ä—Ç–∏—Ü–∏–∏ –µ—Å—Ç—å ¬´–ª–∏–¥–µ—Ä¬ª (Leader) ‚Äî –±—Ä–æ–∫–µ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –∫–ª–∏–µ–Ω—Ç–∞–º–∏.
–ò–º–µ–Ω–Ω–æ –ª–∏–¥–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ø—Ä–æ–¥—é—Å–µ—Ä–∞–º–∏ –∏ –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ –æ—Ç–¥–∞—ë—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
–∫–æ–Ω—Å—å—é–º–µ—Ä–∞–º. –ö –ª–∏–¥–µ—Ä—É –æ—Å—É—â–µ—Å—Ç–≤–ª—è—é—Ç –∑–∞–ø—Ä–æ—Å—ã —Ñ–æ–ª–ª–æ–≤–µ—Ä—ã (Follower) ‚Äî –±—Ä–æ–∫–µ—Ä—ã,
–∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç —Ä–µ–ø–ª–∏–∫—É –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö –ø–∞—Ä—Ç–∏—Ü–∏–π. –°–æ–æ–±—â–µ–Ω–∏—è –≤—Å–µ–≥–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è
–ª–∏–¥–µ—Ä—É –∏, –≤ –æ–±—â–µ–º —Å–ª—É—á–∞–µ, —á–∏—Ç–∞—é—Ç—Å—è —Å –ª–∏–¥–µ—Ä–∞.

## –ë—Ä–æ–∫–µ—Ä—ã

–í Apache Kafka –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ (—É–∑–ª–æ–≤ –∫–ª–∞—Å—Ç–µ—Ä–∞) –Ω–µ –∑–∞–¥–∞–µ—Ç—Å—è –Ω–∞–ø—Ä—è–º—É—é —á–µ—Ä–µ–∑
–∫–∞–∫–æ–π-—Ç–æ –µ–¥–∏–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Ç–æ–ø–∏–∫–∞ –∏–ª–∏ –∫–æ–º–∞–Ω–¥—ã, —Ç–∞–∫ –∫–∞–∫ –æ–Ω–æ
–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–æ–π –≤–∞—à–µ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞. –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ç–æ–≥–æ,
—Å–∫–æ–ª—å–∫–æ —Å–µ—Ä–≤–µ—Ä–æ–≤ (–±—Ä–æ–∫–µ—Ä–æ–≤) –≤—ã —Ä–∞–∑–≤–µ—Ä–Ω—É–ª–∏ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ Kafka. –û–¥–Ω–∞–∫–æ –µ—Å—Ç—å
—Å–≤—è–∑–∞–Ω–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤–ª–∏—è—é—Ç –Ω–∞ —Ç–æ, –∫–∞–∫ –±—Ä–æ–∫–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è, –≤–∫–ª—é—á–∞—è
–Ω–∞—Å—Ç—Ä–æ–π–∫—É —Ç–æ–ø–∏–∫–æ–≤ –∏ –∏—Ö —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é.

–í–æ—Ç –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏–µ, –∫–∞–∫ –∑–∞–¥–∞–µ—Ç—Å—è –∏ –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ—Ç—Å—è –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –≤
Kafka:

### 1. **–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤**

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–µ–º, —Å–∫–æ–ª—å–∫–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ Kafka –≤—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏ –≤
  –∫–ª–∞—Å—Ç–µ—Ä–µ. –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä ‚Äî —ç—Ç–æ –æ—Ç–¥–µ–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å Kafka, —Ä–∞–±–æ—Ç–∞—é—â–∏–π –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ
  –∏–ª–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ.
- –î–ª—è –∑–∞–ø—É—Å–∫–∞ –±—Ä–æ–∫–µ—Ä–∞ –≤—ã –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç–µ –µ–≥–æ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª (
  `server.properties`) –∏ —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä (`broker.id`) –¥–ª—è
  –∫–∞–∂–¥–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞.
- –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ 3 –±—Ä–æ–∫–µ—Ä–∞, –≤—ã –∑–∞–ø—É—Å–∫–∞–µ—Ç–µ 3 –ø—Ä–æ—Ü–µ—Å—Å–∞ Kafka —Å —Ä–∞–∑–Ω—ã–º–∏
  `broker.id` (–Ω–∞–ø—Ä–∏–º–µ—Ä, 0, 1, 2) –Ω–∞ –æ–¥–Ω–æ–º –∏–ª–∏ —Ä–∞–∑–Ω—ã—Ö —Å–µ—Ä–≤–µ—Ä–∞—Ö.

**–ü—Ä–∏–º–µ—Ä –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤ `server.properties`**:

   ```properties
   broker.id=0
listeners=PLAINTEXT://:9092
zookeeper.connect=localhost:2181
   ```

–î–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞ –º–µ–Ω—è–µ—Ç—Å—è `broker.id` –∏, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏, –ø–æ—Ä—Ç –∏–ª–∏ —Ö–æ—Å—Ç –≤
`listeners`.

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ –≤—Å–µ—Ö –±—Ä–æ–∫–µ—Ä–æ–≤ –æ–Ω–∏ –ø–æ–¥–∫–ª—é—á–∞—é—Ç—Å—è –∫ ZooKeeper, –∫–æ—Ç–æ—Ä—ã–π —É–ø—Ä–∞–≤–ª—è–µ—Ç
–∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏–µ–π –∫–ª–∞—Å—Ç–µ—Ä–∞.

### 2. **–°–≤—è–∑—å —Å —Ç–æ–ø–∏–∫–∞–º–∏ –∏ replication factor**

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –Ω–∞–ø—Ä—è–º—É—é –≤–ª–∏—è–µ—Ç –Ω–∞ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π **replication factor** –¥–ª—è
  —Ç–æ–ø–∏–∫–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä, –µ—Å–ª–∏ —É –≤–∞—Å 3 –±—Ä–æ–∫–µ—Ä–∞, —Ç–æ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π replication factor
  –¥–ª—è —Ç–æ–ø–∏–∫–∞ —Ä–∞–≤–µ–Ω 3 (–∫–∞–∂–¥–∞—è –ø–∞—Ä—Ç–∏—Ü–∏—è –º–æ–∂–µ—Ç –∏–º–µ—Ç—å –¥–æ 3 —Ä–µ–ø–ª–∏–∫, –ø–æ –æ–¥–Ω–æ–π –Ω–∞
  –∫–∞–∂–¥–æ–º –±—Ä–æ–∫–µ—Ä–µ).
- –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ —Ç–æ–ø–∏–∫–∞ –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ replication factor, –Ω–æ –æ–Ω –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–µ–≤—ã—à–∞—Ç—å
  –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–æ–≤. –ù–∞–ø—Ä–∏–º–µ—Ä:
  ```bash
  kafka-topics.sh --create --topic my-topic --replication-factor 3 --partitions 4 --bootstrap-server localhost:9092
  ```
  –ó–¥–µ—Å—å Kafka —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç —Ä–µ–ø–ª–∏–∫–∏ –ø–∞—Ä—Ç–∏—Ü–∏–π –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –±—Ä–æ–∫–µ—Ä–∞–º.

–ï—Å–ª–∏ –±—Ä–æ–∫–µ—Ä–æ–≤ –º–µ–Ω—å—à–µ, —á–µ–º —É–∫–∞–∑–∞–Ω–Ω—ã–π replication factor, –∫–æ–º–∞–Ω–¥–∞ –≤—ã–¥–∞—Å—Ç –æ—à–∏–±–∫—É.

### 3. **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–ª–∏ —É–¥–∞–ª–µ–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤**

- **–î–æ–±–∞–≤–ª–µ–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤**:
    1. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –Ω–æ–≤—ã–π —Å–µ—Ä–≤–µ—Ä —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º `broker.id` –≤ `server.properties`.
    2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å Kafka, —É–∫–∞–∑–∞–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ ZooKeeper.
    3. Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∏–Ω—Ç–µ–≥—Ä–∏—Ä—É–µ—Ç –Ω–æ–≤—ã–π –±—Ä–æ–∫–µ—Ä –≤ –∫–ª–∞—Å—Ç–µ—Ä, –∏ –≤—ã –º–æ–∂–µ—Ç–µ
       –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ –Ω–∞ –Ω–æ–≤—ã–π –±—Ä–æ–∫–µ—Ä —Å –ø–æ–º–æ—â—å—é –∫–æ–º–∞–Ω–¥—ã
       `kafka-reassign-partitions.sh`.

- **–£–¥–∞–ª–µ–Ω–∏–µ –±—Ä–æ–∫–µ—Ä–æ–≤**:
    1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç `kafka-reassign-partitions.sh`, —á—Ç–æ–±—ã –ø–µ—Ä–µ–º–µ—Å—Ç–∏—Ç—å
       –≤—Å–µ –ø–∞—Ä—Ç–∏—Ü–∏–∏ —Å —É–¥–∞–ª—è–µ–º–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞ –Ω–∞ –¥—Ä—É–≥–∏–µ.
    2. –û—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø—Ä–æ—Ü–µ—Å—Å Kafka –Ω–∞ —ç—Ç–æ–º –±—Ä–æ–∫–µ—Ä–µ.
    3. –û–±–Ω–æ–≤–∏—Ç–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é ZooKeeper, –µ—Å–ª–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ.

**–ü—Ä–∏–º–µ—Ä –∫–æ–º–∞–Ω–¥—ã –¥–ª—è –ø–µ—Ä–µ–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –ø–∞—Ä—Ç–∏—Ü–∏–π**:

   ```bash
   kafka-reassign-partitions.sh --zookeeper localhost:2181 --reassignment-json-file reassignment.json --execute
   ```

–í —Ñ–∞–π–ª–µ `reassignment.json` –≤—ã —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ, –∫–∞–∫ –ø–µ—Ä–µ—Ä–∞—Å–ø—Ä–µ–¥–µ–ª–∏—Ç—å –ø–∞—Ä—Ç–∏—Ü–∏–∏ –º–µ–∂–¥—É
–±—Ä–æ–∫–µ—Ä–∞–º–∏.

### 4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –±—Ä–æ–∫–µ—Ä–æ–≤**

- –ß—Ç–æ–±—ã —É–∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –∞–∫—Ç–∏–≤–Ω–æ –≤ –∫–ª–∞—Å—Ç–µ—Ä–µ, –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–æ–º–∞–Ω–¥—É:
  ```bash
  kafka-topics.sh --describe --topic my-topic --bootstrap-server localhost:9092
  ```
  –í –≤—ã–≤–æ–¥–µ –±—É–¥—É—Ç —É–∫–∞–∑–∞–Ω—ã –±—Ä–æ–∫–µ—Ä—ã, –Ω–∞ –∫–æ—Ç–æ—Ä—ã—Ö —Ä–∞–∑–º–µ—â–µ–Ω—ã –ª–∏–¥–µ—Ä—ã –∏ —Ä–µ–ø–ª–∏–∫–∏
  –ø–∞—Ä—Ç–∏—Ü–∏–π.
- –¢–∞–∫–∂–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —á–µ—Ä–µ–∑ ZooKeeper –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞, —Ç–∞–∫–∏–µ –∫–∞–∫
  Kafka Manager –∏–ª–∏ Confluent Control Center.

### 5. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ**

- Kafka –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª—è–µ—Ç –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ –∏—Ö —Ä–µ–ø–ª–∏–∫–∏ –ø–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º –±—Ä–æ–∫–µ—Ä–∞–º,
  –µ—Å–ª–∏ –Ω–µ —É–∫–∞–∑–∞–Ω–æ –∏–Ω–æ–µ. –≠—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å —Å –ø–æ–º–æ—â—å—é –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
  `auto.leader.rebalance.enable` –∏–ª–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∞ `kafka-reassign-partitions.sh`
  –¥–ª—è —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

### 6. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏**

- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –¥–æ—Å—Ç–∞—Ç–æ—á–Ω—ã–º –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∂–µ–ª–∞–µ–º–æ–≥–æ —É—Ä–æ–≤–Ω—è
  –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏. –ù–∞–ø—Ä–∏–º–µ—Ä, –¥–ª—è replication factor = 3 —Ç—Ä–µ–±—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3
  –±—Ä–æ–∫–µ—Ä–∞.
- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `broker.id` –∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
  –¥–ª—è —Å–≤—è–∑–∏ —Å ZooKeeper.
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–Ω-—Å–∏—Å—Ç–µ–º —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –º–∏–Ω–∏–º—É–º 3 –±—Ä–æ–∫–µ—Ä–∞, —á—Ç–æ–±—ã –æ–±–µ—Å–ø–µ—á–∏—Ç—å
  –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫—É –Ω–∞–≥—Ä—É–∑–∫–∏.

### –ò—Ç–æ–≥

–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –∑–∞–¥–∞–µ—Ç—Å—è —Ñ–∏–∑–∏—á–µ—Å–∫–∏ ‚Äî —á–µ—Ä–µ–∑ –∑–∞–ø—É—Å–∫ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø—Ä–æ—Ü–µ—Å—Å–æ–≤ Kafka
—Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º–∏ `broker.id`. –í—ã –Ω–µ —É–∫–∞–∑—ã–≤–∞–µ—Ç–µ —ç—Ç–æ —á–∏—Å–ª–æ –≤ –æ–¥–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ, –∞
–æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç–µ –µ–≥–æ, —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞—è –∫–ª–∞—Å—Ç–µ—Ä. –ü–æ—Å–ª–µ —ç—Ç–æ–≥–æ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã, —Ç–∞–∫–∏–µ –∫–∞–∫
replication factor –∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π, –∑–∞–≤–∏—Å—è—Ç –æ—Ç —á–∏—Å–ª–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –±—Ä–æ–∫–µ—Ä–æ–≤.

## –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ —Ç—Ä–µ—Ö –±—Ä–æ–∫–µ—Ä–æ–≤

[docker-compose-3.yml](../../files/docker-compose-3.yml)

–†–∞–∑–≤–µ—Ä–Ω—É—Ç—å –∫–ª–∞—Å—Ç–µ—Ä –∏–∑ **3 –±—Ä–æ–∫–µ—Ä–æ–≤ Kafka** –º–æ–∂–Ω–æ –¥–≤—É–º—è –æ—Å–Ω–æ–≤–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏:

---

### ‚úÖ **1. –ß–µ—Ä–µ–∑ Docker Compose**

Kafka —Å **KRaft** (–±–µ–∑ ZooKeeper) –ø–æ–∑–≤–æ–ª—è–µ—Ç –∑–∞–ø—É—Å–∫–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –±—Ä–æ–∫–µ—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º
`docker-compose.yml`.

–í–æ—Ç –ø—Ä–∏–º–µ—Ä **docker-compose.yml –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –∏–∑ 3 –±—Ä–æ–∫–µ—Ä–æ–≤ + UI**:

```yaml
version: '3.8'

services:
  kafka-1:
    image: confluentinc/cp-kafka:7.5.0
    hostname: kafka-1
    container_name: kafka-1
    ports:
      - "9092:9092"
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://kafka-1:9092,CONTROLLER://kafka-1:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9092
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3

  kafka-2:
    image: confluentinc/cp-kafka:7.5.0
    hostname: kafka-2
    container_name: kafka-2
    ports:
      - "9093:9092"
    environment:
      KAFKA_NODE_ID: 2
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://kafka-2:9092,CONTROLLER://kafka-2:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9093
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3

  kafka-3:
    image: confluentinc/cp-kafka:7.5.0
    hostname: kafka-3
    container_name: kafka-3
    ports:
      - "9094:9092"
    environment:
      KAFKA_NODE_ID: 3
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://kafka-3:9092,CONTROLLER://kafka-3:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://localhost:9094
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      KAFKA_OFFSETS_TOPIC_REPLICATION_FACTOR: 3

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    ports:
      - "8080:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: local
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka-1:9092,kafka-2:9092,kafka-3:9092
```

---

#### üîç **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

* **KRaft —Ä–µ–∂–∏–º** ‚Üí Kafka –±–µ–∑ ZooKeeper.
* **–ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä** –∏–º–µ–µ—Ç —É–Ω–∏–∫–∞–ª—å–Ω—ã–π `KAFKA_NODE_ID`.
* **KAFKA\_CONTROLLER\_QUORUM\_VOTERS** ‚Üí –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç, –∫—Ç–æ –≥–æ–ª–æ—Å—É–µ—Ç –∑–∞
  –ª–∏–¥–µ—Ä—Å—Ç–≤–æ (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä—ã).
* **–†–µ–ø–ª–∏–∫–∞—Ü–∏—è** ‚Üí –≤–æ–∑–º–æ–∂–Ω–∞ (3 –∫–æ–ø–∏–∏).
* **–ü–æ—Ä—Ç—ã:**

    * `kafka-1` –¥–æ—Å—Ç—É–ø–µ–Ω –Ω–∞ `localhost:9092`
    * `kafka-2` –Ω–∞ `localhost:9093`
    * `kafka-3` –Ω–∞ `localhost:9094`

---

### ‚úÖ **2. –õ–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ Docker**

–ú–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å 3 –±—Ä–æ–∫–µ—Ä–∞ –≤—Ä—É—á–Ω—É—é, –Ω–æ:

* –ù—É–∂–Ω–æ **3 –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞** (`server-1.properties`,
  `server-2.properties`, `server-3.properties`).
* –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ `broker.id` (1,2,3).
* –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ `listeners` (–Ω–∞–ø—Ä–∏–º–µ—Ä: `PLAINTEXT://:9092`, `:9093`, `:9094`).
* –û–¥–∏–Ω `KAFKA_HOME`.

–ö–æ–º–∞–Ω–¥–∞ –¥–ª—è –∑–∞–ø—É—Å–∫–∞:

```bash
bin/kafka-server-start.sh config/server-1.properties
```

–ò —Ç–∞–∫ –¥–ª—è –≤—Å–µ—Ö.

---
===

## –ö—Ä–∞—Ç–∫–æ

–î–∞, –∏–º–µ–Ω–Ω–æ —Ç–∞–∫! –ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ **–∫–ª–∞—Å—Ç–µ—Ä–∞ –ª–æ–∫–∞–ª—å–Ω–æ –±–µ–∑ Docker** –Ω—É–∂–Ω–æ:

---

### ‚úÖ **–ö–∞–∫ —É—Å—Ç—Ä–æ–µ–Ω–æ**

Kafka ‚Äî —ç—Ç–æ **–ø—Ä–æ—Ü–µ—Å—Å** (Java-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ), –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–Ω–æ –∑–∞–ø—É—Å—Ç–∏—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ä–∞–∑
–Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ, –µ—Å–ª–∏:

* –£ –∫–∞–∂–¥–æ–≥–æ –ø—Ä–æ—Ü–µ—Å—Å–∞ **—Å–≤–æ–π `broker.id`** (—É–Ω–∏–∫–∞–ª—å–Ω—ã–π –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –±—Ä–æ–∫–µ—Ä–∞ –≤
  –∫–ª–∞—Å—Ç–µ—Ä–µ).
* –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è **listeners** (–Ω–∞–ø—Ä–∏–º–µ—Ä, `9092`, `9093`, `9094`).
* –†–∞–∑–Ω—ã–µ **–ª–æ–≥-–¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏** (—á—Ç–æ–±—ã –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–ª–∏—Å—å).

---

### ‚úÖ **–ü–æ—à–∞–≥–æ–≤–æ**

1. –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –æ–¥–∏–Ω –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ Kafka (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ `/opt/kafka`).
2. –í –ø–∞–ø–∫–µ `config/` –∫–æ–ø–∏—Ä—É–µ—à—å —Ñ–∞–π–ª `server.properties`:

   ```
   server-1.properties
   server-2.properties
   server-3.properties
   ```
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ —Ñ–∞–π–ª–∞ –º–µ–Ω—è–µ—à—å:

* **broker.id** ‚Üí 1, 2, 3
* **listeners** ‚Üí

  ```
  server-1: PLAINTEXT://:9092
  server-2: PLAINTEXT://:9093
  server-3: PLAINTEXT://:9094
  ```
* **log.dirs** ‚Üí

  ```
  /tmp/kafka-logs-1
  /tmp/kafka-logs-2
  /tmp/kafka-logs-3
  ```

4. –ó–∞–ø—É—Å–∫–∞–µ—à—å —Ç—Ä–∏ –∫–æ–º–∞–Ω–¥—ã:

   ```bash
   bin/kafka-server-start.sh config/server-1.properties
   bin/kafka-server-start.sh config/server-2.properties
   bin/kafka-server-start.sh config/server-3.properties
   ```
5. **–ö–ª–∞—Å—Ç–µ—Ä –≥–æ—Ç–æ–≤** ‚Üí –±—Ä–æ–∫–µ—Ä—ã –æ–±—â–∞—é—Ç—Å—è –º–µ–∂–¥—É —Å–æ–±–æ–π –ø–æ ID.

---

### ‚úÖ **–ê –≤ KRaft-—Ä–µ–∂–∏–º–µ?**

–¢–æ –∂–µ —Å–∞–º–æ–µ, —Ç–æ–ª—å–∫–æ:

* –ú–µ–Ω—è–µ—à—å –Ω–µ `broker.id`, –∞ `node.id`.
* –£–∫–∞–∑—ã–≤–∞–µ—à—å `process.roles=broker,controller`.
* –ó–∞–¥–∞–µ—à—å `controller.quorum.voters=1@host1:9093,2@host2:9093,3@host3:9093`.
* –î–ª—è –ø–µ—Ä–≤–æ–≥–æ —Å—Ç–∞—Ä—Ç–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—à—å storage:

  ```bash
  bin/kafka-storage.sh format --config config/server-1.properties --cluster-id $(uuidgen)
  ```

---

–•–æ—á–µ—à—å, —è –¥–∞–º **–ø–æ–ª–Ω—ã–µ —Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã—Ö —Ñ–∞–π–ª–∞ –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ (
ZooKeeper –∏–ª–∏ KRaft)**, —á—Ç–æ–±—ã —Ç—ã –ø—Ä–æ—Å—Ç–æ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª –∏ –∑–∞–ø—É—Å—Ç–∏–ª?

–¥–∞:

## –û—Ç–ª–∏—á–Ω–æ, –≤–æ—Ç –≥–æ—Ç–æ–≤—ã–π –ø—Ä–∏–º–µ—Ä –¥–ª—è **3 –±—Ä–æ–∫–µ—Ä–æ–≤ –≤ KRaft —Ä–µ–∂–∏–º–µ –Ω–∞ –æ–¥–Ω–æ–π –º–∞—à–∏–Ω–µ

**.

---

## ‚úÖ 1. –û—Å–Ω–æ–≤–Ω–∞—è –∏–¥–µ—è

* **–û–¥–∏–Ω –¥–∏—Å—Ç—Ä–∏–±—É—Ç–∏–≤ Kafka**, —Ç—Ä–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
* –ò—Å–ø–æ–ª—å–∑—É–µ–º **KRaft** (–±–µ–∑ ZooKeeper).
* –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä = **broker + controller** (Combined mode).
* –£–Ω–∏–∫–∞–ª—å–Ω—ã–π `node.id` –¥–ª—è –∫–∞–∂–¥–æ–≥–æ.
* –û–±—â–∏–π `cluster.id` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –æ–¥–∏–Ω —Ä–∞–∑).
* –†–∞–∑–Ω—ã–µ –ø–æ—Ä—Ç—ã –¥–ª—è **broker (9092, 9093, 9094)** –∏ **controller (29092, 29093,
  29094)**.
* –†–∞–∑–Ω—ã–µ `log.dirs`.

---

## ‚úÖ 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

–°–æ–∑–¥–∞–π —Ç—Ä–∏ —Ñ–∞–π–ª–∞ –≤ `config/`:

### **server-1.properties**

```properties
process.roles=broker,controller
node.id=1
controller.quorum.voters=1@localhost:29092,2@localhost:29093,3@localhost:29094
listeners=PLAINTEXT://:9092,CONTROLLER://:29092
advertised.listeners=PLAINTEXT://localhost:9092
log.dirs=/tmp/kraft-combined-logs-1
num.partitions=3
# KRaft storage
inter.broker.listener.name=PLAINTEXT
controller.listener.names=CONTROLLER
```

### **server-2.properties**

```properties
process.roles=broker,controller
node.id=2
controller.quorum.voters=1@localhost:29092,2@localhost:29093,3@localhost:29094
listeners=PLAINTEXT://:9093,CONTROLLER://:29093
advertised.listeners=PLAINTEXT://localhost:9093
log.dirs=/tmp/kraft-combined-logs-2
num.partitions=3
inter.broker.listener.name=PLAINTEXT
controller.listener.names=CONTROLLER
```

### **server-3.properties**

```properties
process.roles=broker,controller
node.id=3
controller.quorum.voters=1@localhost:29092,2@localhost:29093,3@localhost:29094
listeners=PLAINTEXT://:9094,CONTROLLER://:29094
advertised.listeners=PLAINTEXT://localhost:9094
log.dirs=/tmp/kraft-combined-logs-3
num.partitions=3
inter.broker.listener.name=PLAINTEXT
controller.listener.names=CONTROLLER
```

---

## ‚úÖ 3. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–ª–∞—Å—Ç–µ—Ä–∞

**–°–Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞–µ–º cluster.id (–æ–¥–∏–Ω —Ä–∞–∑ –¥–ª—è –≤—Å–µ—Ö):**

```bash
CLUSTER_ID=$(bin/kafka-storage.sh random-uuid)
```

**–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ–º –∫–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä:**

```bash
bin/kafka-storage.sh format --config config/server-1.properties --cluster-id $CLUSTER_ID
bin/kafka-storage.sh format --config config/server-2.properties --cluster-id $CLUSTER_ID
bin/kafka-storage.sh format --config config/server-3.properties --cluster-id $CLUSTER_ID
```

---

## ‚úÖ 4. –ó–∞–ø—É—Å–∫ –±—Ä–æ–∫–µ—Ä–æ–≤

–í –æ—Ç–¥–µ–ª—å–Ω—ã—Ö —Ç–µ—Ä–º–∏–Ω–∞–ª–∞—Ö:

```bash
bin/kafka-server-start.sh config/server-1.properties
bin/kafka-server-start.sh config/server-2.properties
bin/kafka-server-start.sh config/server-3.properties
```

---

## ‚úÖ 5. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–ª–∞—Å—Ç–µ—Ä–∞

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞:

```bash
bin/kafka-metadata-quorum.sh describe --bootstrap-server localhost:9092 --status
```

–¢—ã —É–≤–∏–¥–∏—à—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä–∞—Ö –∏ –±—Ä–æ–∫–µ—Ä–∞—Ö.

---

–•–æ—á–µ—à—å, —Å–¥–µ–ª–∞—é **–≤–µ—Ä—Å–∏—é –Ω–∞ Docker Compose –¥–ª—è —ç—Ç–æ–≥–æ –∂–µ –∫–ª–∞—Å—Ç–µ—Ä–∞ (3 –±—Ä–æ–∫–µ—Ä–∞,
KRaft)**? –ò–ª–∏ –ø–æ–∫–∞ –æ—Å—Ç–∞–≤–ª—è–µ–º –Ω–∞ bare metal?

–¥–∞:

–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π Docker Compose –¥–ª—è 3-–±—Ä–æ–∫–µ—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka –≤ KRaft —Ä–µ–∂–∏–º–µ + UI.

–í–æ—Ç –≥–æ—Ç–æ–≤—ã–π **Docker Compose –¥–ª—è 3-–±—Ä–æ–∫–µ—Ä–Ω–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka –≤ KRaft —Ä–µ–∂–∏–º–µ + UI
**.

---

## ‚úÖ `docker-compose.yml`

[docker-compose-5.yml](../../files/docker-compose-5.yml)

### ‚úÖ **–ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç**

* **3 –±—Ä–æ–∫–µ—Ä–∞** (kafka-1, kafka-2, kafka-3).
* –ö–∞–∂–¥—ã–π –±—Ä–æ–∫–µ—Ä –≤ —Ä–æ–ª–∏ **broker + controller** (KRaft combined mode).
* –í—Å–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç **–æ–¥–∏–Ω `CLUSTER_ID`** (`kraft-cluster-id` ‚Üí –º–æ–∂–Ω–æ –∑–∞–º–µ–Ω–∏—Ç—å –Ω–∞
  —Å–≤–æ–π UUID).
* **UI** –Ω–∞ `http://localhost:8080`.
* –î–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ `./data/kafka-{1,2,3}`.

---

### ‚úÖ **–ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å**

1. –°–æ–∑–¥–∞–π –ø–∞–ø–∫—É:

   ```bash
   mkdir -p data/kafka-1 data/kafka-2 data/kafka-3
   ```
2. –ó–∞–ø—É—Å—Ç–∏:

   ```bash
   docker-compose up -d
   ```
3. –ü—Ä–æ–≤–µ—Ä—å —Å—Ç–∞—Ç—É—Å:

   ```bash
   docker ps
   ```
4. –ó–∞–π–¥–∏ –≤ UI:

   ```
   http://localhost:8080
   ```

---

–•–æ—á–µ—à—å, —Å–¥–µ–ª–∞—é **–≤–µ—Ä—Å–∏—é —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–æ–ø–∏–∫–∞ —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏
—Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π = 3** –ø—Ä—è–º–æ —á–µ—Ä–µ–∑ Docker Compose?

–¥–∞:

## –í–æ—Ç –≤–µ—Ä—Å–∏—è `docker-compose.yml`, –≥–¥–µ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç—Å—è *

*—Ç–æ–ø–∏–∫ `user-topic` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π = 3**.

---

### ‚úÖ `docker-compose.yml` —Å –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ–º —Ç–æ–ø–∏–∫–∞

```yaml
version: '3.8'

services:
  kafka-1:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-1
    hostname: kafka-1
    ports:
      - "9092:9092"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 1
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:29092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-1:9092
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
      # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "false"
    volumes:
      - ./data/kafka-1:/var/lib/kafka/data

  kafka-2:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-2
    hostname: kafka-2
    ports:
      - "9093:9093"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 2
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9093,CONTROLLER://0.0.0.0:29093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-2:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
    volumes:
      - ./data/kafka-2:/var/lib/kafka/data

  kafka-3:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-3
    hostname: kafka-3
    ports:
      - "9094:9094"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 3
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9094,CONTROLLER://0.0.0.0:29094
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-3:9094
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
    volumes:
      - ./data/kafka-3:/var/lib/kafka/data

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    ports:
      - "8080:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: kraft-cluster
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka-1:9092,kafka-2:9093,kafka-3:9094

  create-topics:
    image: confluentinc/cp-kafka:7.6.1
    depends_on:
      - kafka-1
      - kafka-2
      - kafka-3
    entrypoint: [ "/bin/bash", "-c" ]
    command:
      - |
        echo "‚è≥ –ñ–¥—É 15 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –∫–ª–∞—Å—Ç–µ—Ä —Å—Ç–∞—Ä—Ç–æ–≤–∞–ª...";
        sleep 15;
        echo "‚úÖ –°–æ–∑–¥–∞—é —Ç–æ–ø–∏–∫ user-topic...";
        kafka-topics --create \
          --bootstrap-server kafka-1:9092 \
          --replication-factor 3 \
          --partitions 3 \
          --topic user-topic;
        echo "üìã –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤:";
        kafka-topics --list --bootstrap-server kafka-1:9092;
```

---

### ‚úÖ –ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å:

* **`KAFKA_AUTO_CREATE_TOPICS_ENABLE: "false"`** ‚Üí —á—Ç–æ–±—ã —Ç–æ–ø–∏–∫–∏ –Ω–µ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å
  –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.
* –î–æ–±–∞–≤–ª–µ–Ω —Å–µ—Ä–≤–∏—Å **`create-topics`**, –∫–æ—Ç–æ—Ä—ã–π:

    * –ñ–¥—ë—Ç 15 —Å–µ–∫—É–Ω–¥, –ø–æ–∫–∞ –±—Ä–æ–∫–µ—Ä—ã –∑–∞–ø—É—Å—Ç—è—Ç—Å—è.
    * –°–æ–∑–¥–∞—ë—Ç **`user-topic` —Å 3 –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ —Ñ–∞–∫—Ç–æ—Ä–æ–º —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏ = 3**.
    * –í—ã–≤–æ–¥–∏—Ç —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö —Ç–æ–ø–∏–∫–æ–≤.

---

### ‚úÖ –ó–∞–ø—É—Å–∫:

```bash
docker-compose up -d
```

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–ø–∏–∫–æ–≤:

```bash
docker-compose logs create-topics
```

---

–•–æ—á–µ—à—å, —Å–¥–µ–ª–∞—é **–µ—â—ë –±–æ–ª–µ–µ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é**, –≥–¥–µ –º–æ–∂–Ω–æ —á–µ—Ä–µ–∑
`docker-compose.override.yml` –∑–∞–¥–∞–≤–∞—Ç—å —Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤ —Å –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–µ–π
–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Å–Ω–æ–≤–Ω–æ–≥–æ —Ñ–∞–π–ª–∞? –ò–ª–∏ —Å—Ä–∞–∑—É **—Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –≤ `.env` —Ñ–∞–π–ª–µ** (—á—Ç–æ–±—ã
—Ç—ã –ø—Ä–æ—Å—Ç–æ –º–µ–Ω—è–ª –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –∫–æ–Ω—Ñ–∏–≥ –Ω–µ —Ç—Ä–æ–≥–∞–ª)?

## –û–±–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞

–î–∞, –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å **–≥–∏–±—Ä–∏–¥–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç**:

* **–û—Å–Ω–æ–≤–Ω–æ–π `docker-compose.yml`** ‚Üí –±–∞–∑–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è (Kafka –∫–ª–∞—Å—Ç–µ—Ä + UI).
* **`.env`** ‚Üí –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (—Å–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤, –∫–æ–ª-–≤–æ –ø–∞—Ä—Ç–∏—Ü–∏–π, —Ñ–∞–∫—Ç–æ—Ä —Ä–µ–ø–ª–∏–∫–∞—Ü–∏–∏).
* **`docker-compose.override.yml`** ‚Üí –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤, –∏—Å–ø–æ–ª—å–∑—É—è
  `.env`.

---

### ‚úÖ 1. `.env` (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –∫–æ–Ω—Ñ–∏–≥)

```env
TOPICS=user-topic,order-topic
PARTITIONS=3
REPLICATION_FACTOR=3
```

---

### ‚úÖ 2. `docker-compose.yml` (–æ—Å–Ω–æ–≤–Ω–æ–π)

```yaml
version: '3.8'

services:
  kafka-1:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-1
    hostname: kafka-1
    ports:
      - "9092:9092"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 1
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9092,CONTROLLER://0.0.0.0:29092
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-1:9092
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
      KAFKA_AUTO_CREATE_TOPICS_ENABLE: "false"
    volumes:
      - ./data/kafka-1:/var/lib/kafka/data

  kafka-2:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-2
    hostname: kafka-2
    ports:
      - "9093:9093"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 2
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9093,CONTROLLER://0.0.0.0:29093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-2:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
    volumes:
      - ./data/kafka-2:/var/lib/kafka/data

  kafka-3:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-3
    hostname: kafka-3
    ports:
      - "9094:9094"
    environment:
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_NODE_ID: 3
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:29092,2@kafka-2:29093,3@kafka-3:29094
      KAFKA_LISTENERS: PLAINTEXT://0.0.0.0:9094,CONTROLLER://0.0.0.0:29094
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-3:9094
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_INTER_BROKER_LISTENER_NAME: PLAINTEXT
      KAFKA_LOG_DIRS: /var/lib/kafka/data
      CLUSTER_ID: "kraft-cluster-id"
    volumes:
      - ./data/kafka-3:/var/lib/kafka/data

  kafka-ui:
    image: provectuslabs/kafka-ui:latest
    container_name: kafka-ui
    ports:
      - "8080:8080"
    environment:
      KAFKA_CLUSTERS_0_NAME: kraft-cluster
      KAFKA_CLUSTERS_0_BOOTSTRAPSERVERS: kafka-1:9092,kafka-2:9093,kafka-3:9094
```

---

### ‚úÖ 3. `docker-compose.override.yml` (–ª–æ–≥–∏–∫–∞ –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤)

```yaml
version: '3.8'

services:
  create-topics:
    image: confluentinc/cp-kafka:7.6.1
    depends_on:
      - kafka-1
      - kafka-2
      - kafka-3
    entrypoint: [ "/bin/bash", "-c" ]
    command: >
      bash -c "
        echo '‚è≥ –ñ–¥—É 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±—Ä–æ–∫–µ—Ä–æ–≤...';
        sleep 15;
        for topic in ${TOPICS//,/ }
        do
          echo '‚úÖ –°–æ–∑–¥–∞—é —Ç–æ–ø–∏–∫: '$topic;
          kafka-topics --create \
            --if-not-exists \
            --bootstrap-server kafka-1:9092 \
            --replication-factor ${REPLICATION_FACTOR} \
            --partitions ${PARTITIONS} \
            --topic $topic;
        done;
        echo 'üìã –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤:';
        kafka-topics --list --bootstrap-server kafka-1:9092;
      "
```

---

### ‚úÖ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç:

* –í `.env` —É–∫–∞–∑—ã–≤–∞–µ—à—å:

  ```
  TOPICS=user-topic,order-topic
  PARTITIONS=3
  REPLICATION_FACTOR=3
  ```
* `create-topics` –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏ —Å–æ–∑–¥–∞—ë—Ç –≤—Å–µ —Ç–æ–ø–∏–∫–∏.
* –ú–µ–Ω—è—Ç—å —Ç–æ–ø–∏–∫–∏ –∏–ª–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ ‚Üí —Ç–æ–ª—å–∫–æ `.env`, —Ñ–∞–π–ª—ã –Ω–µ —Ç—Ä–æ–≥–∞–µ—à—å.

---

–•–æ—á–µ—à—å, —è —Å–¥–µ–ª–∞—é **–µ—â—ë –æ–¥–∏–Ω –≤–∞—Ä–∏–∞–Ω—Ç —Å –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π –≥–∏–±–∫–æ—Å—Ç—å—é**, –≥–¥–µ –º–æ–∂–Ω–æ
–±—É–¥–µ—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–ø–∏–∫–∞ –∑–∞–¥–∞—Ç—å **—Å–≤–æ–∏ –ø–∞—Ä—Ç–∏—Ü–∏–∏ –∏ —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—é**? –ù–∞–ø—Ä–∏–º–µ—Ä:

```
TOPICS=user-topic:3:3,order-topic:5:2
```

–∏ —á—Ç–æ–±—ã —Å–∫—Ä–∏–ø—Ç –ø–∞—Ä—Å–∏–ª —ç—Ç–æ –∏ —Å–æ–∑–¥–∞–≤–∞–ª –ø–æ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º?

–î–ê:

–¢–æ–≥–¥–∞ —Å–¥–µ–ª–∞–µ–º –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π –≤–∞—Ä–∏–∞–Ω—Ç, –≥–¥–µ –º–æ–∂–Ω–æ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–ø–∏–∫–∞ –∑–∞–¥–∞—Ç—å **—Å–≤–æ–∏
–ø–∞—Ä—Ç–∏—Ü–∏–∏** –∏ **—Å–≤–æ–π replication factor** –≤ —Ñ–æ—Ä–º–∞—Ç–µ:

```
TOPICS=user-topic:3:3,order-topic:5:2
```

---

### ‚úÖ 1. `.env`

```env
TOPICS=user-topic:3:3,order-topic:5:2
```

---

### ‚úÖ 2. `docker-compose.override.yml` (–Ω–æ–≤–∞—è –≤–µ—Ä—Å–∏—è)

```yaml
version: '3.8'

services:
  create-topics:
    image: confluentinc/cp-kafka:7.6.1
    depends_on:
      - kafka-1
      - kafka-2
      - kafka-3
    entrypoint: [ "/bin/bash", "-c" ]
    command: >
      bash -c "
        echo '‚è≥ –ñ–¥—É 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±—Ä–æ–∫–µ—Ä–æ–≤...';
        sleep 15;

        IFS=',' read -ra TOPIC_ARRAY <<< '${TOPICS}';
        for t in \"${TOPIC_ARRAY[@]}\"; do
          IFS=':' read -ra PARAMS <<< \"$t\";
          TOPIC_NAME=${PARAMS[0]};
          PARTITIONS=${PARAMS[1]};
          REPL=${PARAMS[2]};
          echo \"‚úÖ –°–æ–∑–¥–∞—é —Ç–æ–ø–∏–∫: $TOPIC_NAME (–ø–∞—Ä—Ç–∏—Ü–∏–π: $PARTITIONS, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è: $REPL)\";
          kafka-topics --create \
            --if-not-exists \
            --bootstrap-server kafka-1:9092 \
            --partitions $PARTITIONS \
            --replication-factor $REPL \
            --topic $TOPIC_NAME;
        done;

        echo 'üìã –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤:';
        kafka-topics --list --bootstrap-server kafka-1:9092;
      "
```

---

### ‚úÖ –ö–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è:

* –í `.env`:

  ```
  TOPICS=user-topic:3:3,order-topic:5:2,analytics:6:3
  ```
* **–†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å**:

    * `,` ‚Üí —Ä–∞–∑–Ω—ã–µ —Ç–æ–ø–∏–∫–∏
    * `:` ‚Üí –∏–º—è:–ø–∞—Ä—Ç–∏—Ü–∏–∏:—Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è

---

#### ‚úÖ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:

‚úî –í—Å–µ —Ç–æ–ø–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤.
‚úî –ì–∏–±–∫–æ—Å—Ç—å: –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–ø–∏–∫–∞ –∑–∞–¥–∞—ë—à—å **—Å–≤–æ–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã**.
‚úî –ú–µ–Ω—è–µ—à—å —Ç–æ–ª—å–∫–æ `.env`, –Ω–µ –ª–µ–∑–µ—à—å –≤ YAML.

---

–•–æ—á–µ—à—å, —è —Å–¥–µ–ª–∞—é **—Ñ–∏–Ω–∞–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é `docker-compose.yml` —Å –ø–æ–ª–Ω—ã–º –∫–ª–∞—Å—Ç–µ—Ä–æ–º
KRaft + UI + –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ —Å –≥–∏–±–∫–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–µ–π** (–æ–±—ä–µ–¥–∏–Ω–∏–º
–≤—Å—ë –≤ –æ–¥–∏–Ω —Ñ–∞–π–ª)?

–¥–∞

## ---

–í–æ—Ç **—Ñ–∏–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è `docker-compose.yml`** –¥–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ **Kafka KRaft** (3
–±—Ä–æ–∫–µ—Ä–∞) + **UI (Kafdrop)** + **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ —Å –≥–∏–±–∫–∏–º–∏
–Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏**:

---

### ‚úÖ 1. –§–∞–π–ª `.env`

```env
CLUSTER_ID=my-cluster
TOPICS=user-topic:3:3,order-topic:5:2,analytics:6:3
```

---

### ‚úÖ 2. `docker-compose.yml`

```yaml
version: '3.8'

services:
  # === –ë—Ä–æ–∫–µ—Ä 1 ===
  kafka-1:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-1
    environment:
      KAFKA_NODE_ID: 1
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://:9092,CONTROLLER://:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-1:9092
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_CLUSTER_ID: ${CLUSTER_ID}
      KAFKA_LOG_DIRS: /var/lib/kafka/data
    volumes:
      - kafka1-data:/var/lib/kafka/data
    ports:
      - "9092:9092"

  # === –ë—Ä–æ–∫–µ—Ä 2 ===
  kafka-2:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-2
    environment:
      KAFKA_NODE_ID: 2
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://:9092,CONTROLLER://:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-2:9092
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_CLUSTER_ID: ${CLUSTER_ID}
      KAFKA_LOG_DIRS: /var/lib/kafka/data
    volumes:
      - kafka2-data:/var/lib/kafka/data
    ports:
      - "9093:9092"

  # === –ë—Ä–æ–∫–µ—Ä 3 ===
  kafka-3:
    image: confluentinc/cp-kafka:7.6.1
    container_name: kafka-3
    environment:
      KAFKA_NODE_ID: 3
      KAFKA_PROCESS_ROLES: broker,controller
      KAFKA_LISTENERS: PLAINTEXT://:9092,CONTROLLER://:9093
      KAFKA_ADVERTISED_LISTENERS: PLAINTEXT://kafka-3:9092
      KAFKA_CONTROLLER_QUORUM_VOTERS: 1@kafka-1:9093,2@kafka-2:9093,3@kafka-3:9093
      KAFKA_CONTROLLER_LISTENER_NAMES: CONTROLLER
      KAFKA_CLUSTER_ID: ${CLUSTER_ID}
      KAFKA_LOG_DIRS: /var/lib/kafka/data
    volumes:
      - kafka3-data:/var/lib/kafka/data
    ports:
      - "9094:9092"

  # === UI (Kafdrop) ===
  kafdrop:
    image: obsidiandynamics/kafdrop
    container_name: kafdrop
    ports:
      - "9000:9000"
    environment:
      KAFKA_BROKERCONNECT: kafka-1:9092,kafka-2:9092,kafka-3:9092
    depends_on:
      - kafka-1
      - kafka-2
      - kafka-3

  # === –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ ===
  create-topics:
    image: confluentinc/cp-kafka:7.6.1
    depends_on:
      - kafka-1
      - kafka-2
      - kafka-3
    entrypoint: [ "/bin/bash", "-c" ]
    command: >
      bash -c "
        echo '‚è≥ –ñ–¥—É 15 —Å–µ–∫—É–Ω–¥ –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –±—Ä–æ–∫–µ—Ä–æ–≤...';
        sleep 15;

        IFS=',' read -ra TOPIC_ARRAY <<< '${TOPICS}';
        for t in \"${TOPIC_ARRAY[@]}\"; do
          IFS=':' read -ra PARAMS <<< \"$t\";
          TOPIC_NAME=${PARAMS[0]};
          PARTITIONS=${PARAMS[1]};
          REPL=${PARAMS[2]};
          echo \"‚úÖ –°–æ–∑–¥–∞—é —Ç–æ–ø–∏–∫: $TOPIC_NAME (–ø–∞—Ä—Ç–∏—Ü–∏–π: $PARTITIONS, —Ä–µ–ø–ª–∏–∫–∞—Ü–∏—è: $REPL)\";
          kafka-topics --create \
            --if-not-exists \
            --bootstrap-server kafka-1:9092 \
            --partitions $PARTITIONS \
            --replication-factor $REPL \
            --topic $TOPIC_NAME;
        done;

        echo 'üìã –°–ø–∏—Å–æ–∫ —Ç–æ–ø–∏–∫–æ–≤:';
        kafka-topics --list --bootstrap-server kafka-1:9092;
      "

volumes:
  kafka1-data:
  kafka2-data:
  kafka3-data:
```

---

### ‚úÖ –ö–∞–∫ –∑–∞–ø—É—Å—Ç–∏—Ç—å

```bash
docker compose up -d
```

* UI ‚Üí `http://localhost:9000`
* –ë—Ä–æ–∫–µ—Ä—ã ‚Üí `localhost:9092, localhost:9093, localhost:9094`

---

### ‚úÖ –ß—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç:

‚úî **3 –±—Ä–æ–∫–µ—Ä–∞ –≤ KRaft —Ä–µ–∂–∏–º–µ** (–∫–æ–Ω—Ç—Ä–æ–ª–µ—Ä—ã –≤–Ω—É—Ç—Ä–∏ –Ω–∏—Ö –∂–µ).
‚úî **Kafdrop UI** –¥–ª—è –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞.
‚úî **–ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –∏–∑ `.env`** (–≥–∏–±–∫–æ, –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Å–≤–æ–π
`partitions:replication`).
‚úî **–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ volumes** ‚Üí –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –Ω–µ —Ç–µ—Ä—è–µ—Ç –∫–ª–∞—Å—Ç–µ—Ä–∞.

---

## –ò–ª–∏ —Å—Ä–∞–∑—É –¥–∞–º **Spring Boot –∫–æ–Ω—Ñ–∏–≥ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —ç—Ç–æ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É (
Producer + Consumer)**?

–í–æ—Ç –ø—Ä–∏–º–µ—Ä **–ø–æ–ª–Ω–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Spring Boot** –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ —Ç–≤–æ–µ–º—É –∫–ª–∞—Å—Ç–µ—Ä—É
**Kafka KRaft (3 –±—Ä–æ–∫–µ—Ä–∞)**:

---

## ‚úÖ 1. `application.yml`

```yaml
spring:
  kafka:
    bootstrap-servers: localhost:9092,localhost:9093,localhost:9094
    consumer:
      group-id: order-service-group
      auto-offset-reset: earliest
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.springframework.kafka.support.serializer.JsonDeserializer
      properties:
        spring.json.trusted.packages: "*"
    producer:
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.springframework.kafka.support.serializer.JsonSerializer
    listener:
      ack-mode: record
```

---

## ‚úÖ 2. –ö–æ–Ω—Ñ–∏–≥-–∫–ª–∞—Å—Å `KafkaConfig.kt`

```kotlin
import org.apache.kafka.clients.admin.NewTopic
import org.apache.kafka.clients.admin.AdminClientConfig
import org.springframework.context.annotation.Bean
import org.springframework.context.annotation.Configuration
import org.springframework.kafka.annotation.EnableKafka
import org.springframework.kafka.config.TopicBuilder
import org.springframework.kafka.core.DefaultKafkaProducerFactory
import org.springframework.kafka.core.KafkaTemplate
import org.springframework.kafka.core.ProducerFactory
import org.springframework.kafka.core.ConsumerFactory
import org.springframework.kafka.core.DefaultKafkaConsumerFactory
import org.springframework.kafka.support.serializer.JsonSerializer
import org.springframework.kafka.support.serializer.JsonDeserializer

@Configuration
@EnableKafka
class KafkaConfig {

    @Bean
    fun producerFactory(): ProducerFactory<String, Any> =
        DefaultKafkaProducerFactory(
            mapOf(
                "bootstrap.servers" to "localhost:9092,localhost:9093,localhost:9094",
                "key.serializer" to org.apache.kafka.common.serialization.StringSerializer::class.java,
                "value.serializer" to JsonSerializer::class.java
            )
        )

    @Bean
    fun kafkaTemplate(): KafkaTemplate<String, Any> =
        KafkaTemplate(producerFactory())

    @Bean
    fun consumerFactory(): ConsumerFactory<String, Any> =
        DefaultKafkaConsumerFactory(
            mapOf(
                "bootstrap.servers" to "localhost:9092,localhost:9093,localhost:9094",
                "group.id" to "order-service-group",
                "key.deserializer" to org.apache.kafka.common.serialization.StringDeserializer::class.java,
                "value.deserializer" to JsonDeserializer::class.java,
                "spring.json.trusted.packages" to "*"
            )
        )

    // ‚úÖ –ü—Ä–∏–º–µ—Ä –∞–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–ø–∏–∫–∞ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ Spring Boot
    @Bean
    fun userTopic(): NewTopic = TopicBuilder.name("user-topic")
        .partitions(3)
        .replicas(3)
        .build()
}
```

---

## ‚úÖ 3. Producer (–æ—Ç–ø—Ä–∞–≤–∫–∞)

```kotlin
import org.springframework.kafka.core.KafkaTemplate
import org.springframework.stereotype.Service
import java.util.UUID

@Service
class UserProducer(private val kafkaTemplate: KafkaTemplate<String, Any>) {

    fun sendUser(user: UserDto) {
        val id = UUID.randomUUID().toString()
        kafkaTemplate.send("user-topic", id, user)
        println("‚úÖ Sent user=$user with id=$id")
    }
}
```

---

## ‚úÖ 4. Consumer (–ø–æ–ª—É—á–µ–Ω–∏–µ)

```kotlin
import org.apache.kafka.clients.consumer.ConsumerRecord
import org.springframework.kafka.annotation.KafkaListener
import org.springframework.stereotype.Service

@Service
class UserConsumer {

    @KafkaListener(topics = ["user-topic"], groupId = "order-service-group")
    fun consume(record: ConsumerRecord<String, UserDto>) {
        println("üì• Received user=${record.value()} with key=${record.key()}")
    }
}
```

---

### **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

‚úî `bootstrap-servers` ‚Üí –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ **3 –±—Ä–æ–∫–µ—Ä–∞–º** (`9092,9093,9094`) –¥–ª—è
–æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏.
‚úî –ê–≤—Ç–æ—Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–∞ `user-topic` —Å `3` –ø–∞—Ä—Ç–∏—Ü–∏—è–º–∏ –∏ `3` —Ä–µ–ø–ª–∏–∫–∞–º–∏ (—á–µ—Ä–µ–∑
`@Bean`).
‚úî Producer ‚Üí –æ—Ç–ø—Ä–∞–≤–∫–∞ **—Å –∫–ª—é—á–æ–º (UUID)**.
‚úî Consumer ‚Üí –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `ConsumerRecord`, –º–æ–∂–Ω–æ –¥–æ—Å—Ç–∞—Ç—å **–∫–ª—é—á** (—Ç–æ—Ç —Å–∞–º—ã–π
`id`).
